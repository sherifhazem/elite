<!DOCTYPE html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>تسجيل الشركات | ELITE</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
            integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
        <style>
            :root {
                color-scheme: light;
                --page-bg: radial-gradient(circle at top, #f3ebff 0%, #f7f5fb 45%, #ffffff 100%);
                --card-bg: rgba(255, 255, 255, 0.9);
                --primary: #6a1b9a;
                --primary-dark: #4a136c;
                --gold: #f6c342;
                --text: #2f1740;
                --error: #d32f2f;
            }

            * {
                box-sizing: border-box;
            }

            body {
                margin: 0;
                padding: 32px 16px 48px;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                font-family: "Tajawal", "Segoe UI", Tahoma, sans-serif;
                background: var(--page-bg);
                color: var(--text);
            }

            .register-shell {
                width: min(560px, 100%);
                display: grid;
                gap: 20px;
            }

            .register-header {
                display: grid;
                gap: 16px;
                text-align: center;
            }

            .register-header__badge {
                width: 72px;
                height: 72px;
                border-radius: 24px;
                margin: 0 auto;
                display: grid;
                place-items: center;
                background: linear-gradient(135deg, rgba(106, 27, 154, 0.2), rgba(246, 195, 66, 0.24));
                color: var(--primary);
                font-size: 30px;
            }

            .register-header__title {
                margin: 0;
                font-size: clamp(1.5rem, 4vw, 1.9rem);
                font-weight: 700;
            }

            .register-header__subtitle {
                margin: 0 auto;
                line-height: 1.7;
                max-width: 460px;
                color: rgba(47, 23, 64, 0.78);
                font-size: 1rem;
            }

            .register-card {
                background: var(--card-bg);
                border-radius: 28px;
                padding: 32px 28px 36px;
                box-shadow: 0 24px 48px rgba(106, 27, 154, 0.12);
                display: grid;
                gap: 22px;
            }

            .visually-hidden {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            .register-card h2 {
                margin: 0;
                font-size: 1.2rem;
                font-weight: 700;
            }

            form {
                display: grid;
                gap: 18px;
            }

            .input-field {
                display: grid;
                gap: 8px;
            }

            label {
                font-weight: 600;
                font-size: 0.95rem;
            }

            input,
            textarea {
                font: inherit;
                padding: 12px 14px;
                border-radius: 14px;
                border: 1px solid rgba(106, 27, 154, 0.16);
                background: rgba(255, 255, 255, 0.92);
                transition: border-color 150ms ease, box-shadow 150ms ease;
                resize: none;
            }

            input:focus,
            textarea:focus {
                outline: none;
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(106, 27, 154, 0.18);
            }

            textarea {
                min-height: 120px;
                line-height: 1.6;
            }

            .cta-button {
                border: none;
                border-radius: 999px;
                background: linear-gradient(135deg, var(--primary), #8e24aa);
                color: #ffffff;
                padding: 14px 24px;
                font-size: 1.05rem;
                font-weight: 700;
                cursor: pointer;
                transition: transform 150ms ease, box-shadow 150ms ease;
                box-shadow: 0 16px 28px rgba(106, 27, 154, 0.2);
            }

            .cta-button:disabled {
                opacity: 0.65;
                cursor: progress;
                box-shadow: none;
            }

            .helper-text {
                margin: 0;
                text-align: center;
                color: rgba(47, 23, 64, 0.75);
                font-size: 0.95rem;
            }

            .helper-text a {
                color: var(--primary);
                font-weight: 600;
                text-decoration: none;
            }

            .helper-text a:hover,
            .helper-text a:focus {
                text-decoration: underline;
            }

            .error-message {
                margin: 0;
                color: var(--error);
                font-size: 0.92rem;
                min-height: 20px;
            }

            .toast-banner {
                position: fixed;
                bottom: 24px;
                inset-inline-start: 50%;
                transform: translateX(-50%) translateY(120%);
                display: inline-flex;
                align-items: center;
                gap: 12px;
                padding: 14px 18px;
                border-radius: 18px;
                background: linear-gradient(135deg, var(--gold), #f0a500);
                color: var(--primary-dark);
                font-weight: 600;
                box-shadow: 0 20px 40px rgba(246, 195, 66, 0.25);
                transition: transform 220ms ease, opacity 220ms ease;
                opacity: 0;
                z-index: 10;
            }

            .toast-banner[data-visible="true"] {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }

            .success-badge {
                width: 44px;
                height: 44px;
                border-radius: 14px;
                background: rgba(255, 255, 255, 0.16);
                display: grid;
                place-items: center;
                color: var(--primary-dark);
            }

            @media (max-width: 360px) {
                body {
                    padding: 24px 12px 36px;
                }

                .register-card {
                    padding: 28px 20px 32px;
                }
            }
        </style>
    </head>
    <body>
        <main class="register-shell">
            <header class="register-header">
                <div class="register-header__badge" aria-hidden="true">
                    <i class="fa-solid fa-building"></i>
                </div>
                <h1 class="register-header__title">إنشاء حساب شركة في ELITE</h1>
                <p class="register-header__subtitle">
                    صممنا هذه التجربة خصيصًا لفرق التسويق وروّاد الأعمال لتفعيل العروض والوصول إلى
                    مجتمع أعضاء ELITE بسهولة وسرعة.
                </p>
            </header>
            <section class="register-card" aria-labelledby="company-register-title">
                <h2 id="company-register-title" class="visually-hidden">نموذج تسجيل الشركات</h2>
                <form id="company-register-form" novalidate>
                    <div class="input-field">
                        <label for="company-name">اسم الشركة</label>
                        <input
                            type="text"
                            id="company-name"
                            name="company_name"
                            autocomplete="organization"
                            required
                            placeholder="مثال: شركة النخبة"
                        />
                    </div>
                    <div class="input-field">
                        <label for="company-email">البريد الإلكتروني الرسمي</label>
                        <input
                            type="email"
                            id="company-email"
                            name="email"
                            inputmode="email"
                            autocomplete="email"
                            required
                            placeholder="company@example.com"
                        />
                    </div>
                    <div class="input-field">
                        <label for="company-password">كلمة المرور</label>
                        <input
                            type="password"
                            id="company-password"
                            name="password"
                            autocomplete="new-password"
                            required
                            minlength="6"
                            placeholder="••••••••"
                        />
                    </div>
                    <div class="input-field">
                        <label for="company-description">وصف مختصر (اختياري)</label>
                        <textarea
                            id="company-description"
                            name="description"
                            rows="4"
                            placeholder="عرفنا عن عروضك المميزة وفريقك."
                        ></textarea>
                    </div>
                    <p id="company-register-error" class="error-message" role="alert" aria-live="polite"></p>
                    <button type="submit" id="company-register-submit" class="cta-button">
                        إنشاء حساب الشركة
                    </button>
                </form>
                <p class="helper-text">
                    لست شركة؟
                    <a href="{{ url_for('auth.register_page') }}">سجّل كعضو للاستفادة من العروض</a>
                </p>
            </section>
        </main>
        <div class="toast-banner" id="company-register-toast" role="status" aria-live="polite">
            <div class="success-badge" aria-hidden="true"><i class="fa-solid fa-check"></i></div>
            <span id="company-register-toast-message">تم إنشاء حساب الشركة بنجاح! جاري تحويلك...</span>
        </div>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const form = document.getElementById("company-register-form");
                const nameInput = document.getElementById("company-name");
                const emailInput = document.getElementById("company-email");
                const passwordInput = document.getElementById("company-password");
                const descriptionInput = document.getElementById("company-description");
                const submitButton = document.getElementById("company-register-submit");
                const errorMessage = document.getElementById("company-register-error");
                const toast = document.getElementById("company-register-toast");
                const toastMessage = document.getElementById("company-register-toast-message");

                if (!form) {
                    return;
                }

                const showToast = (message) => {
                    if (!toast || !toastMessage) {
                        return;
                    }
                    toastMessage.textContent = message || "تم إنشاء حساب الشركة بنجاح";
                    toast.dataset.visible = "true";
                    setTimeout(() => {
                        toast.dataset.visible = "false";
                    }, 3200);
                };

                form.addEventListener("submit", async (event) => {
                    event.preventDefault();

                    const companyName = (nameInput.value || "").trim();
                    const email = (emailInput.value || "").trim();
                    const password = passwordInput.value || "";
                    const description = (descriptionInput.value || "").trim();

                    if (!companyName || !email || !password) {
                        errorMessage.textContent = "يرجى تعبئة الحقول الإلزامية.";
                        return;
                    }

                    errorMessage.textContent = "";
                    submitButton.disabled = true;
                    submitButton.textContent = "جاري إنشاء الحساب...";

                    try {
                        const payload = {
                            company_name: companyName,
                            email,
                            password,
                        };
                        if (description) {
                            payload.description = description;
                        }

                        const response = await fetch("/api/companies/register", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(payload),
                        });
                        const data = await response.json();

                        if (!response.ok) {
                            errorMessage.textContent = data?.error || "تعذر إنشاء حساب الشركة، حاول مرة أخرى.";
                            return;
                        }

                        showToast("تم إنشاء حساب الشركة بنجاح! جاري تحويلك...");
                        const redirectTarget = data.redirect_url || "/login-page";
                        setTimeout(() => {
                            window.location.replace(redirectTarget);
                        }, 1400);
                    } catch (error) {
                        console.error("Company registration failed", error);
                        errorMessage.textContent = "حدث خطأ غير متوقع. يرجى المحاولة لاحقًا.";
                    } finally {
                        submitButton.disabled = false;
                        submitButton.textContent = "إنشاء حساب الشركة";
                    }
                });
            });
        </script>
    </body>
</html>
