<!-- FIXED: Mobile-First User Portal Design (Member-Only) -->
{% set active_nav = active_nav or '' %}
<!DOCTYPE html>
<html lang="ar" dir="rtl" class="portal-mobile-shell">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
        <title>{% block title %}ELITE Mobile Portal{% endblock %}</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
            integrity="sha512-VlC5x7r+J1kG0VYLRNvKcJsteVEh9UpAJZciV06Pq4jG3Ejj6+UeJ8V+RaH59RUW2KIiMzH6I0X58F3R9yN9ZA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=2" />
        <link rel="icon" href="{{ url_for('static', filename='images/logo.png') }}" type="image/png" />
        <style>
            :root {
                color-scheme: light;
                --portal-bg: #f7f6fb;
                --portal-surface: rgba(255, 255, 255, 0.92);
                --portal-border: rgba(255, 255, 255, 0.4);
                --portal-primary: #4e2b8f;
                --portal-primary-soft: #8c5bff;
                --portal-text: #1a1533;
                --portal-muted: #8f8ca6;
                font-family: "Tajawal", "Inter", "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            }

            * {
                box-sizing: border-box;
            }

            body.portal-mobile-body {
                margin: 0;
                min-height: 100vh;
                background: linear-gradient(180deg, rgba(78, 43, 143, 0.08), transparent 55%), var(--portal-bg);
                color: var(--portal-text);
                -webkit-font-smoothing: antialiased;
            }

            .app-shell {
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                background: linear-gradient(160deg, rgba(255, 255, 255, 0.96), rgba(255, 255, 255, 0.82));
                position: relative;
            }

            .app-header {
                padding: 20px 24px 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                position: sticky;
                top: 0;
                z-index: 10;
                backdrop-filter: blur(14px);
                background: rgba(247, 246, 251, 0.78);
                border-bottom: 1px solid rgba(255, 255, 255, 0.4);
            }

            .header-title {
                font-size: clamp(1.1rem, 3.4vw, 1.3rem);
                font-weight: 700;
                color: var(--portal-text);
            }

            .app-main {
                flex: 1 1 auto;
                padding-bottom: 84px;
            }

            .view-container {
                padding: 0 18px 32px;
                display: flex;
                flex-direction: column;
                gap: 24px;
            }

            /* ✅ Updated bottom navigation bar */
            .app-nav {
                position: sticky;
                bottom: 0;
                left: 0;
                right: 0;
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                background: #ffffff;
                border-top: 1px solid #ddd;
                padding: 10px 12px 12px;
                box-shadow: none;
                z-index: 20;
            }

            .app-nav__item {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 4px;
                padding: 8px 6px;
                border-radius: 10px;
                text-decoration: none;
                background: none;
                font-size: 0.8rem;
                font-weight: 600;
                color: #4e2b8f;
                transition: color 0.2s ease-in-out, background 0.2s ease-in-out;
                z-index: 21;
            }

            .app-nav__icon {
                font-size: 1.25rem;
                line-height: 1;
                color: inherit;
            }

            .app-nav__label {
                font-size: 0.72rem;
                color: inherit;
                line-height: 1.1;
                text-align: center;
            }

            .app-nav__item--active {
                background: #4e2b8f;
                color: #ffffff;
            }

            .app-nav__item:active {
                opacity: 0.8;
            }

            .app-nav__item:focus-visible {
                outline: 2px solid #8c5bff;
                outline-offset: 2px;
            }

            .app-nav__badge {
                min-width: 22px;
                padding: 2px 6px;
                border-radius: 999px;
                background: var(--portal-primary);
                color: #fff;
                font-size: 0.7rem;
                font-weight: 600;
            }

            .toast-stack {
                position: fixed;
                inset-inline: 16px;
                top: 20px;
                display: grid;
                gap: 12px;
                z-index: 60;
            }

            .loading-indicator {
                display: grid;
                place-items: center;
                position: fixed;
                inset: 0;
                background: rgba(19, 18, 38, 0.32);
                z-index: 80;
            }

            @media (min-width: 768px) {
                body.portal-mobile-body {
                    display: grid;
                    place-items: center;
                }

                .app-shell {
                    width: min(420px, 100%);
                    border-radius: 32px;
                    box-shadow: 0 48px 120px rgba(26, 21, 51, 0.22);
                    overflow: hidden;
                }
            }
        </style>
    </head>
    <body class="portal-mobile-body">
        <div class="app-shell" id="app-shell" data-active-nav="{{ active_nav }}">
            <header class="app-header" id="portal-header">
                <div class="header-title" id="portal-page-title">{% block page_heading %}ELITE{% endblock %}</div>
            </header>
            <main class="app-main" id="portal-main" role="main">
                <section class="view-container" id="portal-view" data-current-view="{{ active_nav }}">
                    {% block content %}{% endblock %}
                </section>
            </main>

            <!-- ✅ Updated visible bottom navigation -->
            <nav class="app-nav" aria-label="Primary navigation">
                <a
                    class="app-nav__item {% if active_nav == 'home' %}app-nav__item--active{% endif %}"
                    href="{{ url_for('portal.home') }}"
                    data-nav-link
                    data-nav-target="home"
                >
                    <span class="app-nav__icon"><i class="fa-solid fa-house"></i></span>
                    <span class="app-nav__label">الرئيسية</span>
                </a>

                <a
                    class="app-nav__item {% if active_nav == 'offers' %}app-nav__item--active{% endif %}"
                    href="{{ url_for('portal.offers') }}"
                    data-nav-link
                    data-nav-target="offers"
                >
                    <span class="app-nav__icon"><i class="fa-solid fa-gift"></i></span>
                    <span class="app-nav__label">العروض</span>
                </a>

                <a
                    class="app-nav__item {% if active_nav == 'profile' %}app-nav__item--active{% endif %}"
                    href="{{ url_for('portal.profile') }}"
                    data-nav-link
                    data-nav-target="profile"
                >
                    <span class="app-nav__icon"><i class="fa-solid fa-user"></i></span>
                    <span class="app-nav__label">الملف</span>
                </a>

                <a
                    class="app-nav__item {% if active_nav == 'notifications' %}app-nav__item--active{% endif %}"
                    href="{{ url_for('portal.notifications') }}"
                    data-nav-link
                    data-nav-target="notifications"
                >
                    <span class="app-nav__icon"><i class="fa-solid fa-bell"></i></span>
                    <span class="app-nav__label">الإشعارات</span>
                    {% if notification_unread_count %}
                    <span class="app-nav__badge" id="notification-count">{{ notification_unread_count }}</span>
                    {% endif %}
                </a>
            </nav>
        </div>

        <div class="app-modal" id="portal-modal" role="dialog" aria-modal="true" hidden>
            <div class="app-modal__backdrop" data-modal-dismiss aria-hidden="true"></div>
            <article class="app-modal__sheet" role="document">
                <header class="app-modal__header">
                    <h2 class="app-modal__title" id="modal-title">Details</h2>
                    <button class="app-modal__close" type="button" data-modal-dismiss aria-label="Close">×</button>
                </header>
                <div class="app-modal__body" id="modal-body"></div>
            </article>
        </div>

        <div class="toast-stack" id="toast-container" aria-live="polite" aria-atomic="true"></div>

        <div class="loading-indicator" id="loading-indicator" hidden>
            <div class="loading-indicator__spinner" aria-hidden="true"></div>
            <span class="loading-indicator__label">Loading</span>
        </div>

        <script src="{{ url_for('static', filename='js/main.js') }}?v=2" defer></script>
    </body>
</html>
