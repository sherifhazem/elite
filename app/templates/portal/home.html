<!-- LINKED: Standardized conditional access checks across templates using current_user-based logic. -->
<!-- FIXED: Mobile-First User Portal Design (Member-Only) -->
{% extends 'portal/base.html' %}
{% block title %}الرئيسية · ELITE{% endblock %}
{% block page_heading %}الرئيسية{% endblock %}
{% block content %}
    <style>
        .home-hero {
            background: linear-gradient(145deg, rgba(78, 43, 143, 0.92), rgba(140, 91, 255, 0.85));
            border-radius: 28px;
            padding: 28px 24px;
            color: #fff;
            display: flex;
            flex-direction: column;
            gap: 18px;
            box-shadow: 0 28px 80px rgba(61, 40, 120, 0.35);
        }

        .home-hero__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .home-hero__badge {
            padding: 6px 14px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
            font-size: 0.85rem;
        }

        .home-hero__logo {
            width: 46px;
            height: 46px;
            border-radius: 16px;
            background: rgba(0, 0, 0, 0.18);
            display: grid;
            place-items: center;
            font-size: 1.4rem;
        }

        .home-hero__title {
            margin: 0;
            font-size: clamp(1.4rem, 4.8vw, 1.8rem);
            font-weight: 700;
            line-height: 1.4;
        }

        .home-hero__text {
            margin: 0;
            color: rgba(255, 255, 255, 0.85);
            line-height: 1.7;
        }

        .home-hero__actions {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
        }

        .home-hero__cta,
        .home-hero__secondary {
            border-radius: 16px;
            padding: 14px;
            text-align: center;
            font-weight: 600;
            font-size: 0.95rem;
            text-decoration: none;
        }

        .home-hero__cta {
            background: #fff;
            color: #4e2b8f;
        }

        .home-hero__secondary {
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: #fff;
            backdrop-filter: blur(4px);
        }

        .home-section {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .section-headline {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .section-headline__title {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .section-headline__link {
            border: none;
            background: none;
            color: var(--portal-primary, #4e2b8f);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .featured-carousel {
            display: flex;
            overflow-x: auto;
            gap: 16px;
            padding-bottom: 6px;
            scroll-snap-type: x mandatory;
        }

        .offer-chip {
            min-width: 220px;
            padding: 18px;
            border-radius: 22px;
            background: #fff;
            box-shadow: 0 18px 50px rgba(17, 14, 42, 0.08);
            display: flex;
            flex-direction: column;
            gap: 8px;
            scroll-snap-align: start;
        }

        .offer-chip__level {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--portal-primary, #4e2b8f);
        }

        .offer-chip__title {
            margin: 0;
            font-size: 1rem;
            font-weight: 700;
        }

        .offer-chip__discount {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--portal-primary, #4e2b8f);
        }

        .tiers-list {
            display: grid;
            gap: 12px;
        }

        .tier-card {
            border-radius: 20px;
            padding: 18px 20px;
            background: #fff;
            box-shadow: 0 14px 40px rgba(31, 24, 56, 0.08);
        }

        .tier-card h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 700;
        }

        .tier-card p {
            margin: 8px 0 0;
            color: var(--portal-muted, #8f8ca6);
            font-size: 0.92rem;
        }

        @media (min-width: 520px) {
            .featured-carousel {
                overflow-x: hidden;
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            }
        }
    </style>
    <section class="home-hero" data-membership-tier="{{ membership_level|lower }}">
        <div class="home-hero__header">
            <span class="home-hero__badge">{{ membership_level }}</span>
            <div class="home-hero__logo" aria-hidden="true"><i class="fa-solid fa-crown"></i></div>
        </div>
        <div>
            <h1 class="home-hero__title">
                {% if current_user.is_authenticated %}
                    مرحباً {{ current_user.username }}
                {% else %}
                    مرحباً بك في ELITE
                {% endif %}
            </h1>
            <p class="home-hero__text">
                {% if current_user.is_authenticated %}
                    تابع أحدث العروض المتاحة لمستوى <strong>{{ membership_level }}</strong> واجمع نقاطك بسهولة من الهاتف.
                {% else %}
                    قم بتسجيل الدخول لمزامنة عضويتك والوصول إلى أفضل العروض المصممة للأعضاء.
                {% endif %}
            </p>
        </div>
        <div class="home-hero__actions">
            <a class="home-hero__cta" href="{{ url_for('portal.offers') }}" data-nav-link data-nav-target="offers">استكشف العروض</a>
            <a class="home-hero__secondary" href="{{ url_for('portal.profile') }}" data-nav-link data-nav-target="profile">عرض الملف</a>
        </div>
    </section>
    <section class="home-section">
        <div class="section-headline">
            <h2 class="section-headline__title">عروض مختارة</h2>
            <button
                class="section-headline__link"
                type="button"
                data-nav-link
                data-nav-target="offers"
                data-route="{{ url_for('portal.offers') }}"
            >
                عرض الكل
            </button>
        </div>
        <div class="featured-carousel" data-featured-carousel>
            <div class="featured-carousel__track" data-featured-track data-membership-level="{{ membership_level }}">
                {% set featured_offers = featured_offers | default([]) %}
                {% if featured_offers %}
                    {% for offer in featured_offers %}
                        {% set discount_value = '%.0f'|format(offer.get_discount_for_level(membership_level)) %}
                        <article
                            class="offer-chip"
                            data-offer-id="{{ offer.id }}"
                            data-offer-title="{{ offer.title }}"
                            data-offer-company="{{ offer.company.name if offer.company else 'شريك ELITE' }}"
                            data-offer-discount="{{ discount_value }}"
                            data-offer-level="{{ membership_level }}"
                            data-offer-valid="{{ offer.valid_until.strftime('%Y-%m-%d') if offer.valid_until else 'مستمر' }}"
                        >
                            <div class="offer-chip__level">{{ membership_level }}</div>
                            <h3 class="offer-chip__title">{{ offer.title }}</h3>
                            <p class="offer-chip__company">{{ offer.company.name if offer.company else 'عرض حصري' }}</p>
                            <span class="offer-chip__discount">{{ discount_value }}%</span>
                        </article>
                    {% endfor %}
                {% else %}
                    <article class="offer-chip offer-chip--placeholder" data-featured-placeholder>
                        <h3 class="offer-chip__title">سنقترح عروضاً بمجرد تسجيل الدخول</h3>
                        <p class="offer-chip__company">تابعنا يومياً للحصول على تحديثات جديدة.</p>
                    </article>
                {% endif %}
            </div>
        </div>
    </section>
    <section class="home-section">
        <h2 class="section-headline__title">مستويات البرنامج</h2>
        <div class="tiers-list">
            <article class="tier-card tier-card--basic">
                <h3>Basic</h3>
                <p>ابدأ رحلتك مع خصومات تمهيدية من شركائنا الموثوقين.</p>
            </article>
            <article class="tier-card tier-card--silver">
                <h3>Silver</h3>
                <p>نقاط إضافية مع كل تفاعل ومكافآت مخصصة لمناسباتك.</p>
            </article>
            <article class="tier-card tier-card--gold">
                <h3>Gold</h3>
                <p>خدمة دعم أولوية مع خصومات أكبر على أفضل العروض.</p>
            </article>
            <article class="tier-card tier-card--premium">
                <h3>Premium</h3>
                <p>تجربة VIP متكاملة مع مزايا حصرية وخصومات مضاعفة.</p>
            </article>
        </div>
    </section>
{% endblock %}
