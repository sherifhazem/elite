<!-- Company settings form for updating profile and notification preferences. -->
<!-- UPDATED: Responsive Company Portal with Restricted Editable Fields. -->
{% extends "companies/base.html" %}

{% block portal_title %}الإعدادات{% endblock %}

{% block portal_content %}
{% set owner_email = company.owner.email if company and company.owner and company.owner.email else (current_user.email
if current_user else '') %}
{% if company is not none and company.registration_number is defined %}
{% set registration_value = company.registration_number or '' %}
{% else %}
{% set registration_value = none %}
{% endif %}
<section class="settings-layout">
    <form id="company-settings-form" data-action="{{ url_for('company_portal.company_settings') }}"
        class="settings-form" novalidate enctype="multipart/form-data">
        {% include "companies/_csrf_field.html" %}
        <fieldset class="settings-section">
            <legend>ملف الشركة</legend>
            <div class="row g-4">
                <div class="col-12 col-lg-5">
                    <label class="form-label" for="company-logo">الشعار</label>
                    <input type="file" class="form-control visually-hidden" id="company-logo" name="logo_file"
                        accept="image/png,image/jpeg,image/webp,image/svg+xml">
                    <label class="logo-upload-card" for="company-logo">
                        <span class="logo-upload-icon" aria-hidden="true">
                            <svg viewBox="0 0 24 24" focusable="false" aria-hidden="true">
                                <path
                                    d="M9 3a1 1 0 0 0-1 1v1H6a3 3 0 0 0-3 3v8a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3V8a3 3 0 0 0-3-3h-2V4a1 1 0 1 0-2 0v1h-4V4a1 1 0 0 0-1-1Zm9 4a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h12Zm-6 2.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Zm0 2a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z" />
                            </svg>
                        </span>
                        <span class="logo-upload-text">اضغط لإضافة الشعار</span>
                        <img id="company-logo-preview"
                            src="{{ company.logo_url or url_for('static', filename='companies/images/logo-placeholder.svg') }}"
                            alt="{{ company.name }} شعار" class="logo-upload-preview">
                    </label>
                    <div class="form-text">الرجاء رفع لوجو بقياس 400×120 بحد أقصى وحجم أقل من 2MB.</div>
                </div>
                <div class="col-12 col-lg-7">
                    <label for="company-description" class="form-label">الوصف</label>
                    <textarea class="form-control" id="company-description" name="description" rows="4"
                        placeholder="صف مزايا شركتك">{{ company.description or '' }}</textarea>
                </div>
            </div>
        </fieldset>
        <fieldset class="settings-section">
            <legend>نظرة عامة على الحساب</legend>
            <div class="row g-4">
                <div class="col-md-6">
                    <label for="company-name" class="form-label">اسم الشركة</label>
                    <input type="text" class="form-control" id="company-name" name="name" value="{{ company.name }}"
                        readonly data-restricted-field>
                    <div class="form-text text-warning-emphasis">هذا الحقل لا يمكن تعديله إلا بموافقة الإدارة.</div>
                </div>
                <div class="col-md-6">
                    <label for="company-email" class="form-label">البريد الإلكتروني للحساب</label>
                    <input type="email" class="form-control" id="company-email" name="account_email"
                        value="{{ owner_email }}" readonly data-restricted-field>
                    <div class="form-text text-warning-emphasis">يتطلب موافقة الإدارة.</div>
                </div>
                {% if registration_value is not none %}
                <div class="col-md-6">
                    <label for="company-industry" class="form-label">مجال العمل</label>
                    <input type="text" class="form-control" id="company-industry" name="industry"
                        value="{{ company.industry or '' }}" readonly data-restricted-field>
                    <div class="form-text text-warning-emphasis">يتطلب موافقة الإدارة للتعديل.</div>
                </div>
                <div class="col-md-6">
                    <label for="company-registration" class="form-label">رقم السجل</label>
                    <input type="text" class="form-control" id="company-registration" name="registration_number"
                        value="{{ registration_value }}" readonly data-restricted-field>
                    <div class="form-text text-warning-emphasis">يتطلب موافقة الإدارة.</div>
                </div>
                {% else %}
                <div class="col-md-6">
                    <label for="company-industry" class="form-label">مجال العمل</label>
                    <input type="text" class="form-control" id="company-industry" name="industry"
                        value="{{ company.industry or '' }}" readonly data-restricted-field>
                    <div class="form-text text-warning-emphasis">يتطلب موافقة الإدارة للتعديل.</div>
                </div>
                {% endif %}
            </div>
        </fieldset>
        <div class="settings-actions">
            <button type="reset" class="btn btn-elite-outline">إعادة ضبط</button>
            <button type="submit" class="btn btn-elite-primary" id="settings-submit-btn">حفظ التغييرات</button>
        </div>
    </form>
</section>
<div class="toast-container position-fixed bottom-0 end-0 p-3" id="settings-toast-container"></div>
{% endblock %}

{% block portal_scripts %}
<script src="{{ url_for('static', filename='companies/js/company_settings.js') }}" defer></script>
{% endblock %}
