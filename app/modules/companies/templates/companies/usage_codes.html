{% extends "companies/base.html" %}

{% block portal_title %}أكواد الاستخدام{% endblock %}
{% block portal_subtitle %}يتم إنشاء كود الاستخدام تلقائياً ويبقى فعالاً حتى استبداله بعد 10 استخدامات.{% endblock %}

{% block portal_content %}
<div class="row g-4">
    <div class="col-lg-8">
        <div class="card shadow-sm usage-code-card">
            <div class="card-body">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-start gap-3">
                    <div>
                        <h2 class="h5 mb-2">كود الاستخدام الحالي</h2>
                        <p class="text-muted mb-0">شارك هذا الكود مع الأعضاء لتأكيد الاستخدام، ويتم تحديثه تلقائياً.</p>
                    </div>
                    <button class="btn btn-elite-primary" type="button" data-generate-usage-code>
                        إنشاء كود جديد
                    </button>
                </div>

                <div class="usage-code-display mt-4" data-usage-code-value>
                    {{ active_code.code if active_code else "—" }}
                </div>

                <div class="usage-code-meta mt-3">
                    <div>
                        <span class="text-muted small">الصلاحية</span>
                        <div data-usage-code-expires>
                            {{ active_code.expires_at.strftime("%Y-%m-%d %H:%M") if active_code and active_code.expires_at else "مفتوحة" }}
                        </div>
                    </div>
                    <div>
                        <span class="text-muted small">عدد مرات الاستخدام</span>
                        <div data-usage-code-usage>
                            {{ active_code.usage_count if active_code else 0 }}
                            /
                            {{ active_code.max_uses_per_window if active_code else settings.max_uses_per_window }}
                        </div>
                    </div>
                </div>

                <p class="text-muted small mt-3 mb-0">
                    يتم إنشاء الكود وتحديثه تلقائياً كل 10 استخدامات بدون الحاجة لتحديث الصفحة.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block portal_scripts %}
<script src="{{ url_for('static', filename='companies/js/usage_codes.js') }}" defer></script>
{% endblock %}
