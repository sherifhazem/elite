{% extends "companies/base.html" %}

{% block portal_title %}أكواد الاستخدام{% endblock %}
{% block portal_subtitle %}{% endblock %}

{% block portal_content %}
{% set max_uses = active_code.max_uses_per_window if active_code else settings.max_uses_per_window %}
{% set used_uses = active_code.usage_count if active_code else 0 %}
{% set remaining_uses = max_uses - used_uses %}
<div class="row g-4">
    <div class="col-lg-6">
        <div class="card shadow-sm usage-code-card">
            <div class="card-body d-flex flex-column gap-4">
                <div class="usage-code-display" data-usage-code-value>
                    {{ active_code.code if active_code else "—" }}
                </div>
                <button class="btn btn-elite-primary align-self-start" type="button" data-generate-usage-code>
                    إنشاء كود جديد
                </button>
                <div class="usage-code-meta">
                    <span class="text-muted small">عدد مرات الاستخدام المتبقية</span>
                    <div data-usage-code-usage>
                        {{ remaining_uses }}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block portal_scripts %}
<script src="{{ url_for('static', filename='companies/js/usage_codes.js') }}" defer></script>
{% endblock %}
