{% extends "dashboard/admin_base.html" %}
<!-- LINKED: Added admin-managed dropdown system for Cities and Industries. -->
{% set active_page = 'settings' %}

{% block content %}
    <div class="container-fluid py-4">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
            <div>
                <h1 class="h3 mb-1">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©</h1>
                <p class="text-muted mb-0">
                    ØªØ­ÙƒÙ… Ø¨Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø¯Ù† ÙˆÙ…Ø¬Ø§Ù„Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯ÙÙ…Ø© ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Øª Ù…Ù† Ù…ÙƒØ§Ù†Ù ÙˆØ§Ø­Ø¯.
                </p>
            </div>
            <div class="text-md-end text-muted small">
                <span class="d-block">Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ØªØ¸Ù‡Ø± ÙÙˆØ±Ù‹Ø§ ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„.</span>
                <span>ÙŠØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¯Ø§Ø®Ù„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù….</span>
            </div>
        </div>

        <ul class="nav nav-pills admin-pills">
            <li class="nav-item">
                <a
                    class="nav-link {{ 'active' if active_settings_tab == 'cities' else '' }}"
                    href="{{ url_for('admin.settings_home', tab='cities') }}"
                >
                    Ø§Ù„Ù…Ø¯Ù†
                </a>
            </li>
            <li class="nav-item">
                <a
                    class="nav-link {{ 'active' if active_settings_tab == 'industries' else '' }}"
                    href="{{ url_for('admin.settings_home', tab='industries') }}"
                >
                    Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„Ø¹Ù…Ù„
                </a>
            </li>
        </ul>

        <div class="tab-content mt-4">
            <div class="tab-pane fade {{ 'show active' if active_settings_tab == 'cities' else '' }}" id="settings-cities" role="tabpanel">
                <div class="card shadow-sm admin-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="h5 mb-0">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯Ù†</h2>
                            <span class="text-muted small">ØªØ­ÙƒÙ‘Ù… Ø¨Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.</span>
                        </div>
                        <button
                            class="btn btn-primary"
                            type="button"
                            data-bs-toggle="modal"
                            data-bs-target="#addListModal"
                            data-list-type="cities"
                            data-modal-title="Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙŠÙ†Ø©"
                            data-submit-label="Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©"
                        >
                            â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙŠÙ†Ø©
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table align-middle mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">Ø§Ù„Ø§Ø³Ù…</th>
                                    <th scope="col" class="text-center">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th scope="col" class="text-end">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if cities %}
                                    {% for city in cities %}
                                        <tr>
                                            <td class="fw-medium">{{ city.name }}</td>
                                            <td class="text-center">
                                                {% if city.active %}
                                                    <span class="badge bg-success-subtle text-success">Ù…ÙØ¹Ù„</span>
                                                {% else %}
                                                    <span class="badge bg-secondary-subtle text-secondary">Ù…ÙˆÙ‚ÙˆÙ</span>
                                                {% endif %}
                                            </td>
                                            <td class="text-end">
                                                <div class="btn-group" role="group">
                                                    <button
                                                        class="btn btn-sm btn-outline-primary js-edit-item"
                                                        type="button"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#editListModal"
                                                        data-list-type="cities"
                                                        data-item-id="{{ city.id }}"
                                                        data-item-name="{{ city.name }}"
                                                        data-item-active="{{ '1' if city.active else '0' }}"
                                                        data-modal-title="ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¯ÙŠÙ†Ø©"
                                                        data-submit-label="Ø­ÙØ¸ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©"
                                                    >
                                                        âœï¸ ØªØ¹Ø¯ÙŠÙ„
                                                    </button>
                                                    <form
                                                        class="d-inline"
                                                        method="post"
                                                        action="{{ url_for('admin.delete_city', item_id=city.id) }}"
                                                        onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŸ');"
                                                    >
                                                        <button class="btn btn-sm btn-outline-danger" type="submit">ğŸ—‘ Ø­Ø°Ù</button>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="3" class="text-center text-muted py-4">
                                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯Ù† Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade {{ 'show active' if active_settings_tab == 'industries' else '' }}" id="settings-industries" role="tabpanel">
                <div class="card shadow-sm admin-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="h5 mb-0">Ù‚Ø§Ø¦Ù…Ø© Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„Ø¹Ù…Ù„</h2>
                            <span class="text-muted small">ØªØ­ÙƒÙ‘Ù… Ø¨Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© ÙÙŠ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ø§Ù„ Ø¹Ù…Ù„ Ø§Ù„Ø´Ø±ÙƒØ©.</span>
                        </div>
                        <button
                            class="btn btn-primary"
                            type="button"
                            data-bs-toggle="modal"
                            data-bs-target="#addListModal"
                            data-list-type="industries"
                            data-modal-title="Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ø§Ù„"
                            data-submit-label="Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ø§Ù„"
                        >
                            â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ø§Ù„
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table align-middle mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">Ø§Ù„Ø§Ø³Ù…</th>
                                    <th scope="col" class="text-center">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th scope="col" class="text-end">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if industries %}
                                    {% for industry in industries %}
                                        <tr>
                                            <td class="fw-medium">{{ industry.name }}</td>
                                            <td class="text-center">
                                                {% if industry.active %}
                                                    <span class="badge bg-success-subtle text-success">Ù…ÙØ¹Ù„</span>
                                                {% else %}
                                                    <span class="badge bg-secondary-subtle text-secondary">Ù…ÙˆÙ‚ÙˆÙ</span>
                                                {% endif %}
                                            </td>
                                            <td class="text-end">
                                                <div class="btn-group" role="group">
                                                    <button
                                                        class="btn btn-sm btn-outline-primary js-edit-item"
                                                        type="button"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#editListModal"
                                                        data-list-type="industries"
                                                        data-item-id="{{ industry.id }}"
                                                        data-item-name="{{ industry.name }}"
                                                        data-item-active="{{ '1' if industry.active else '0' }}"
                                                        data-modal-title="ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¬Ø§Ù„"
                                                        data-submit-label="Ø­ÙØ¸ Ø§Ù„Ù…Ø¬Ø§Ù„"
                                                    >
                                                        âœï¸ ØªØ¹Ø¯ÙŠÙ„
                                                    </button>
                                                    <form
                                                        class="d-inline"
                                                        method="post"
                                                        action="{{ url_for('admin.delete_industry', item_id=industry.id) }}"
                                                        onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ø§Ù„ØŸ');"
                                                    >
                                                        <button class="btn btn-sm btn-outline-danger" type="submit">ğŸ—‘ Ø­Ø°Ù</button>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="3" class="text-center text-muted py-4">
                                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ø§Ù„Ø§Øª Ø¹Ù…Ù„ Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± -->
    <div class="modal fade" id="addListModal" tabindex="-1" aria-labelledby="addListModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addListModalLabel">Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ±</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="post" id="addListForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label" for="addItemName">Ø§Ù„Ø§Ø³Ù…</label>
                            <input class="form-control" id="addItemName" name="name" type="text" required>
                        </div>
                        <div class="form-check form-switch">
                            <input type="hidden" name="is_active" value="0">
                            <input class="form-check-input" id="addItemActive" name="is_active" type="checkbox" value="1" checked>
                            <label class="form-check-label" for="addItemActive">Ù†Ø´Ø· ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                        <button type="submit" class="btn btn-primary" id="addListSubmit">Ø­ÙØ¸</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†ØµØ± -->
    <div class="modal fade" id="editListModal" tabindex="-1" aria-labelledby="editListModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editListModalLabel">ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†ØµØ±</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="post" id="editListForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label" for="editItemName">Ø§Ù„Ø§Ø³Ù…</label>
                            <input class="form-control" id="editItemName" name="name" type="text" required>
                        </div>
                        <div class="form-check form-switch">
                            <input type="hidden" name="is_active" value="0">
                            <input class="form-check-input" id="editItemActive" name="is_active" type="checkbox" value="1">
                            <label class="form-check-label" for="editItemActive">Ù†Ø´Ø· ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                        <button type="submit" class="btn btn-primary" id="editListSubmit">Ø­ÙØ¸</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
    {{ super() }}
    <script>
        const addListModal = document.getElementById('addListModal');
        const editListModal = document.getElementById('editListModal');

        const modalConfig = {
            cities: {
                addAction: '{{ url_for('admin.add_city') }}',
                editAction: (id) => '{{ url_for('admin.update_city', item_id='__ID__') }}'.replace('__ID__', id)
            },
            industries: {
                addAction: '{{ url_for('admin.add_industry') }}',
                editAction: (id) => '{{ url_for('admin.update_industry', item_id='__ID__') }}'.replace('__ID__', id)
            }
        };

        addListModal?.addEventListener('show.bs.modal', (event) => {
            const trigger = event.relatedTarget;
            if (!trigger) {
                return;
            }
            const listType = trigger.getAttribute('data-list-type');
            const modalTitle = trigger.getAttribute('data-modal-title');
            const submitLabel = trigger.getAttribute('data-submit-label');

            const form = document.getElementById('addListForm');
            form.reset();
            form.action = modalConfig[listType]?.addAction || '#';
            document.getElementById('addItemActive').checked = true;
            document.getElementById('addListModalLabel').textContent = modalTitle || 'Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ±';
            document.getElementById('addListSubmit').textContent = submitLabel || 'Ø­ÙØ¸';
        });

        editListModal?.addEventListener('show.bs.modal', (event) => {
            const trigger = event.relatedTarget;
            if (!trigger) {
                return;
            }
            const listType = trigger.getAttribute('data-list-type');
            const itemId = trigger.getAttribute('data-item-id');
            const itemName = trigger.getAttribute('data-item-name');
            const itemActive = trigger.getAttribute('data-item-active');
            const modalTitle = trigger.getAttribute('data-modal-title');
            const submitLabel = trigger.getAttribute('data-submit-label');

            const form = document.getElementById('editListForm');
            form.action = modalConfig[listType]?.editAction(itemId) || '#';
            document.getElementById('editItemName').value = itemName || '';
            const activeCheckbox = document.getElementById('editItemActive');
            activeCheckbox.checked = itemActive === '1';
            document.getElementById('editListModalLabel').textContent = modalTitle || 'ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†ØµØ±';
            document.getElementById('editListSubmit').textContent = submitLabel || 'Ø­ÙØ¸';
        });
    </script>
{% endblock %}
