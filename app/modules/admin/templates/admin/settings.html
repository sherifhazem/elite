{% extends "admin/dashboard/admin_base.html" %}
{% set active_page = 'settings' %}

{% block content %}
<div class="container-fluid py-4" id="admin-settings-root">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
        <div>
            <h1 class="h3 mb-1">ุฅุนุฏุงุฏุงุช ุงูููุงุฆู ุงููุฑูุฒูุฉ</h1>
            <p class="text-muted mb-0">
                ูุชู ุชุญููู ููุงุฆู ุงููุฏู ููุฌุงูุงุช ุงูุนูู ูุจุงุดุฑุฉ ูู ุงูุณุฌู ุงููุฑูุฒู.
                ุงูุชุนุฏููุงุช ููุฑูุฉ ูุชูุนูุณ ุนูู ูุงุฌูุฉ ุงูุชุณุฌูู ูุงูุฎุฏูุงุช.
            </p>
        </div>
        <div class="text-md-end text-muted small">
            <span class="d-block">ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุจุนุฏ ุงูุชุนุฏูู.</span>
            <span>ูุญูุธ ูู ุชุนุฏูู ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ููุณุฌู.</span>
        </div>
    </div>

    <ul class="nav nav-pills admin-pills">
        <li class="nav-item">
            <a
                class="nav-link {{ 'active' if selected_tab == 'cities' else '' }}"
                href="{{ url_for('admin.settings_home', tab='cities') }}"
            >
                ุงููุฏู
            </a>
        </li>
        <li class="nav-item">
            <a
                class="nav-link {{ 'active' if selected_tab == 'industries' else '' }}"
                href="{{ url_for('admin.settings_home', tab='industries') }}"
            >
                ูุฌุงูุงุช ุงูุนูู
            </a>
        </li>
        <li class="nav-item">
            <a
                class="nav-link {{ 'active' if selected_tab == 'membership_discounts' else '' }}"
                href="{{ url_for('admin.settings_home', tab='membership_discounts') }}"
            >
                ุฎุตููุงุช ุงูุนุถููุฉ
            </a>
        </li>
    </ul>

    <div class="tab-content mt-4">
        <div class="tab-pane fade {{ 'show active' if selected_tab == 'cities' else '' }}" id="settings-cities" role="tabpanel">
            <div class="card shadow-sm admin-card mb-4">
                <div class="card-header d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3">
                    <div>
                        <h2 class="h5 mb-0">ูุงุฆูุฉ ุงููุฏู</h2>
                        <span class="text-muted small">ูุชู ุงูุงุนุชูุงุฏ ุนูู ูุฐู ุงููุงุฆูุฉ ุฃุซูุงุก ุชุณุฌูู ุงูุดุฑูุงุช.</span>
                    </div>
                    <form class="d-flex gap-2 flex-wrap align-items-center js-add-form" data-list-type="cities" action="{{ url_for('admin.add_city') }}" method="post">
                        <label class="visually-hidden" for="add-city-input">ูุฏููุฉ ุฌุฏูุฏุฉ</label>
                        <input class="form-control" id="add-city-input" name="name" type="text" placeholder="ุฃุฏุฎู ูุฏููุฉ ุฌุฏูุฏุฉ" required>
                        <button class="btn btn-primary" type="submit">โ ุฅุถุงูุฉ ูุฏููุฉ</button>
                    </form>
                </div>
                <div class="card-body">
                    <div class="alert alert-danger d-none" role="alert" data-feedback="cities"></div>
                    <div class="table-responsive">
                        <table class="table align-middle mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">ุงูุงุณู</th>
                                    <th scope="col" class="text-end">ุงูุฅุฌุฑุงุกุงุช</th>
                                </tr>
                            </thead>
                            <tbody data-list-table="cities">
                                {% if cities %}
                                    {% for city in cities %}
                                        <tr data-value="{{ city }}">
                                            <td class="fw-medium">{{ city }}</td>
                                            <td class="text-end">
                                                <div class="btn-group" role="group">
                                                    <button
                                                        class="btn btn-sm btn-outline-primary js-edit-item"
                                                        type="button"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#editItemModal"
                                                        data-list-type="cities"
                                                        data-current-value="{{ city }}"
                                                    >
                                                        โ๏ธ ุชุนุฏูู
                                                    </button>
                                                    <button
                                                        class="btn btn-sm btn-outline-danger js-delete-item"
                                                        type="button"
                                                        data-list-type="cities"
                                                        data-value="{{ city }}"
                                                    >
                                                        ๐ ุญุฐู
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr class="js-empty-row" data-list-type="cities">
                                        <td colspan="2" class="text-center text-muted py-4">ูุง ุชูุฌุฏ ูุฏู ูุณุฌูุฉ.</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade {{ 'show active' if selected_tab == 'industries' else '' }}" id="settings-industries" role="tabpanel">
            <div class="card shadow-sm admin-card mb-4">
                <div class="card-header d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3">
                    <div>
                        <h2 class="h5 mb-0">ูุงุฆูุฉ ูุฌุงูุงุช ุงูุนูู</h2>
                        <span class="text-muted small">ูุชู ุนุฑุถ ุงูุฎูุงุฑุงุช ูุจุงุดุฑุฉ ูู ุงูุณุฌู ุงููุฑูุฒู.</span>
                    </div>
                    <form class="d-flex gap-2 flex-wrap align-items-center js-add-form" data-list-type="industries" action="{{ url_for('admin.add_industry') }}" method="post">
                        <label class="visually-hidden" for="add-industry-input">ูุฌุงู ุนูู ุฌุฏูุฏ</label>
                        <input class="form-control" id="add-industry-input" name="name" type="text" placeholder="ุฃุฏุฎู ูุฌุงู ุนูู ุฌุฏูุฏ" required>
                        <button class="btn btn-primary" type="submit">โ ุฅุถุงูุฉ ูุฌุงู</button>
                    </form>
                </div>
                <div class="card-body">
                    <div class="alert alert-danger d-none" role="alert" data-feedback="industries"></div>
                    <div class="table-responsive">
                        <table class="table align-middle mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">ุงูุงุณู</th>
                                    <th scope="col" class="text-end">ุงูุฅุฌุฑุงุกุงุช</th>
                                </tr>
                            </thead>
                            <tbody data-list-table="industries">
                                {% if industries %}
                                    {% for industry in industries %}
                                        <tr data-value="{{ industry }}">
                                            <td class="fw-medium">{{ industry }}</td>
                                            <td class="text-end">
                                                <div class="btn-group" role="group">
                                                    <button
                                                        class="btn btn-sm btn-outline-primary js-edit-item"
                                                        type="button"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#editItemModal"
                                                        data-list-type="industries"
                                                        data-current-value="{{ industry }}"
                                                    >
                                                        โ๏ธ ุชุนุฏูู
                                                    </button>
                                                    <button
                                                        class="btn btn-sm btn-outline-danger js-delete-item"
                                                        type="button"
                                                        data-list-type="industries"
                                                        data-value="{{ industry }}"
                                                    >
                                                        ๐ ุญุฐู
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr class="js-empty-row" data-list-type="industries">
                                        <td colspan="2" class="text-center text-muted py-4">ูุง ุชูุฌุฏ ูุฌุงูุงุช ุนูู ูุณุฌูุฉ.</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div
            class="tab-pane fade {{ 'show active' if selected_tab == 'membership_discounts' else '' }}"
            id="settings-membership-discounts"
            role="tabpanel"
        >
            <div class="card shadow-sm admin-card mb-4">
                <div class="card-header d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3">
                    <div>
                        <h2 class="h5 mb-0">ุฎุตููุงุช ุงูุนุถููุฉ</h2>
                        <span class="text-muted small">ูู ุจุชุนุฏูู ูุณุจุฉ ุงูุฎุตู ููู ูุณุชูู ุนุถููุฉ.</span>
                    </div>
                    <div class="text-muted small">ูุชู ุชุทุจูู ุงูุชุบููุฑุงุช ูุจุงุดุฑุฉ ุฏูู ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ.</div>
                </div>
                <div class="card-body">
                    <div class="alert alert-danger d-none" role="alert" data-feedback="membership_discounts"></div>
                    <form id="membership-discounts-form" class="d-flex flex-column gap-3">
                        <div class="table-responsive">
                            <table class="table align-middle mb-0">
                                <thead>
                                    <tr>
                                        <th scope="col">ูุณุชูู ุงูุนุถููุฉ</th>
                                        <th scope="col">ูุณุจุฉ ุงูุฎุตู (%)</th>
                                    </tr>
                                </thead>
                                <tbody data-membership-table>
                                    {% if membership_discounts %}
                                        {% for entry in membership_discounts %}
                                            <tr data-membership-discount-row data-membership-level="{{ entry.membership_level }}">
                                                <td class="fw-medium">{{ entry.membership_level }}</td>
                                                <td style="max-width: 180px;">
                                                    <div class="form-text mb-1">ุงุฏุฎู ุฑููุงู ุจูู 0 ู 100</div>
                                                    <input
                                                        type="number"
                                                        class="form-control form-control-sm"
                                                        name="discount_percentage"
                                                        min="0"
                                                        max="100"
                                                        step="0.1"
                                                        value="{{ entry.discount_percentage }}"
                                                        data-discount-input
                                                    >
                                                    <div class="invalid-feedback"></div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr class="text-center text-muted">
                                            <td colspan="2">ูุง ุชูุฌุฏ ุฎุตููุงุช ุนุถููุฉ ุญุงููุงู.</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                        <div class="d-flex justify-content-end gap-2">
                            <button type="submit" class="btn btn-primary">ุญูุธ ุงูุฎุตููุงุช</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ุชุนุฏูู ุนูุตุฑ -->
<div
    class="modal fade"
    id="editItemModal"
    tabindex="-1"
    aria-labelledby="editItemModalLabel"
    aria-hidden="true"
    data-update-city-action="{{ url_for('admin.update_city') }}"
    data-update-industry-action="{{ url_for('admin.update_industry') }}"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editItemModalLabel">ุชุนุฏูู ุนูุตุฑ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" id="editItemForm">
                <div class="modal-body">
                    <input type="hidden" name="current_value" id="editCurrentValue">
                    <div class="mb-3">
                        <label class="form-label" for="editItemName">ุงูุงุณู</label>
                        <input class="form-control" id="editItemName" name="name" type="text" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                    <button type="submit" class="btn btn-primary" id="editItemSubmit">ุญูุธ</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
    {{ super() }}
    <script id="admin-settings-context" type="application/json">
        {{ {
            "selected_tab": selected_tab,
            "cities": cities,
            "industries": industries,
            "membership_discounts": membership_discounts,
            "endpoints": {
                "add_city": url_for('admin.add_city'),
                "add_industry": url_for('admin.add_industry'),
                "update_city": url_for('admin.update_city'),
                "update_industry": url_for('admin.update_industry'),
                "delete_city": url_for('admin.delete_city'),
                "delete_industry": url_for('admin.delete_industry'),
                "save_settings": url_for('admin.save_settings'),
            },
        } | tojson }}
    </script>
    <script src="{{ url_for('static', filename='admin/js/settings.js') }}" defer></script>
{% endblock %}
