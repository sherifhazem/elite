{% extends "admin/dashboard/admin_base.html" %}
<!-- LINKED: Added admin-managed dropdown system for Cities and Industries. -->
{% set active_page = 'settings' %}

{% block content %}
    <div class="container-fluid py-4">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-4">
            <div>
                <h1 class="h3 mb-1">ุฅุฏุงุฑุฉ ุงูููุงุฆู ุงูููุณุฏูุฉ</h1>
                <p class="text-muted mb-0">
                    ุชุญูู ุจููุงุฆู ุงููุฏู ููุฌุงูุงุช ุงูุนูู ุงููุณุชุฎุฏููุฉ ูู ุชุณุฌูู ุงูุดุฑูุงุช ูู ููุงูู ูุงุญุฏ.
                </p>
            </div>
            <div class="text-md-end text-muted small">
                <span class="d-block">ุงูุชุบููุฑุงุช ุชุธูุฑ ููุฑูุง ูู ูุงุฌูุฉ ุงูุชุณุฌูู.</span>
                <span>ูุชู ุญูุธ ุฌููุน ุงูุชุนุฏููุงุช ุชููุงุฆููุง ุฏุงุฎู ุฅุนุฏุงุฏุงุช ุงููุธุงู.</span>
            </div>
        </div>

        <ul class="nav nav-pills admin-pills">
            <li class="nav-item">
                <a
                    class="nav-link {{ 'active' if active_settings_tab == 'cities' else '' }}"
                    href="{{ url_for('admin.settings_home', tab='cities') }}"
                >
                    ุงููุฏู
                </a>
            </li>
            <li class="nav-item">
                <a
                    class="nav-link {{ 'active' if active_settings_tab == 'industries' else '' }}"
                    href="{{ url_for('admin.settings_home', tab='industries') }}"
                >
                    ูุฌุงูุงุช ุงูุนูู
                </a>
            </li>
        </ul>

        <div class="tab-content mt-4">
            <div class="tab-pane fade {{ 'show active' if active_settings_tab == 'cities' else '' }}" id="settings-cities" role="tabpanel">
                <div class="card shadow-sm admin-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="h5 mb-0">ูุงุฆูุฉ ุงููุฏู</h2>
                            <span class="text-muted small">ุชุญููู ุจุงููุฏู ุงููุนุฑูุถุฉ ุฃุซูุงุก ุชุณุฌูู ุงูุดุฑูุงุช ุงูุฌุฏูุฏุฉ.</span>
                        </div>
                        <button
                            class="btn btn-primary"
                            type="button"
                            data-bs-toggle="modal"
                            data-bs-target="#addListModal"
                            data-list-type="cities"
                            data-modal-title="ุฅุถุงูุฉ ูุฏููุฉ"
                            data-submit-label="ุฅุถุงูุฉ ุงููุฏููุฉ"
                        >
                            โ ุฅุถุงูุฉ ูุฏููุฉ
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table align-middle mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">ุงูุงุณู</th>
                                    <th scope="col" class="text-center">ุงูุญุงูุฉ</th>
                                    <th scope="col" class="text-end">ุงูุฅุฌุฑุงุกุงุช</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if cities %}
                                    {% for city in cities %}
                                        <tr>
                                            <td class="fw-medium">{{ city.name }}</td>
                                            <td class="text-center">
                                                {% if city.active %}
                                                    <span class="badge bg-success-subtle text-success">ููุนู</span>
                                                {% else %}
                                                    <span class="badge bg-secondary-subtle text-secondary">ููููู</span>
                                                {% endif %}
                                            </td>
                                            <td class="text-end">
                                                <div class="btn-group" role="group">
                                                    <button
                                                        class="btn btn-sm btn-outline-primary js-edit-item"
                                                        type="button"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#editListModal"
                                                        data-list-type="cities"
                                                        data-item-id="{{ city.id }}"
                                                        data-item-name="{{ city.name }}"
                                                        data-item-active="{{ '1' if city.active else '0' }}"
                                                        data-modal-title="ุชุนุฏูู ูุฏููุฉ"
                                                        data-submit-label="ุญูุธ ุงููุฏููุฉ"
                                                    >
                                                        โ๏ธ ุชุนุฏูู
                                                    </button>
                                                    <form
                                                        class="d-inline"
                                                        method="post"
                                                        action="{{ url_for('admin.delete_city', item_id=city.id) }}"
                                                        onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงููุฏููุฉุ');"
                                                    >
                                                        <button class="btn btn-sm btn-outline-danger" type="submit">๐ ุญุฐู</button>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="3" class="text-center text-muted py-4">
                                            ูุง ุชูุฌุฏ ูุฏู ูุณุฌูุฉ ุญุงูููุง.
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade {{ 'show active' if active_settings_tab == 'industries' else '' }}" id="settings-industries" role="tabpanel">
                <div class="card shadow-sm admin-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="h5 mb-0">ูุงุฆูุฉ ูุฌุงูุงุช ุงูุนูู</h2>
                            <span class="text-muted small">ุชุญููู ุจุงูุฎุงูุงุช ุงููุนุฑูุถุฉ ูู ุงุฎุชูุงุฑ ูุฌุงู ุนูู ุงูุดุฑูุฉ.</span>
                        </div>
                        <button
                            class="btn btn-primary"
                            type="button"
                            data-bs-toggle="modal"
                            data-bs-target="#addListModal"
                            data-list-type="industries"
                            data-modal-title="ุฅุถุงูุฉ ูุฌุงู"
                            data-submit-label="ุฅุถุงูุฉ ุงููุฌุงู"
                        >
                            โ ุฅุถุงูุฉ ูุฌุงู
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table align-middle mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">ุงูุงุณู</th>
                                    <th scope="col" class="text-center">ุงูุญุงูุฉ</th>
                                    <th scope="col" class="text-end">ุงูุฅุฌุฑุงุกุงุช</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if industries %}
                                    {% for industry in industries %}
                                        <tr>
                                            <td class="fw-medium">{{ industry.name }}</td>
                                            <td class="text-center">
                                                {% if industry.active %}
                                                    <span class="badge bg-success-subtle text-success">ููุนู</span>
                                                {% else %}
                                                    <span class="badge bg-secondary-subtle text-secondary">ููููู</span>
                                                {% endif %}
                                            </td>
                                            <td class="text-end">
                                                <div class="btn-group" role="group">
                                                    <button
                                                        class="btn btn-sm btn-outline-primary js-edit-item"
                                                        type="button"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#editListModal"
                                                        data-list-type="industries"
                                                        data-item-id="{{ industry.id }}"
                                                        data-item-name="{{ industry.name }}"
                                                        data-item-active="{{ '1' if industry.active else '0' }}"
                                                        data-modal-title="ุชุนุฏูู ูุฌุงู"
                                                        data-submit-label="ุญูุธ ุงููุฌุงู"
                                                    >
                                                        โ๏ธ ุชุนุฏูู
                                                    </button>
                                                    <form
                                                        class="d-inline"
                                                        method="post"
                                                        action="{{ url_for('admin.delete_industry', item_id=industry.id) }}"
                                                        onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงููุฌุงูุ');"
                                                    >
                                                        <button class="btn btn-sm btn-outline-danger" type="submit">๐ ุญุฐู</button>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="3" class="text-center text-muted py-4">
                                            ูุง ุชูุฌุฏ ูุฌุงูุงุช ุนูู ูุณุฌูุฉ ุญุงูููุง.
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ุฅุถุงูุฉ ุนูุตุฑ -->
    <div
        class="modal fade"
        id="addListModal"
        tabindex="-1"
        aria-labelledby="addListModalLabel"
        aria-hidden="true"
        data-add-city-action="{{ url_for('admin.add_city') }}"
        data-add-industry-action="{{ url_for('admin.add_industry') }}"
    >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addListModalLabel">ุฅุถุงูุฉ ุนูุตุฑ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="post" id="addListForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label" for="addItemName">ุงูุงุณู</label>
                            <input class="form-control" id="addItemName" name="name" type="text" required>
                        </div>
                        <div class="form-check form-switch">
                            <input type="hidden" name="is_active" value="0">
                            <input class="form-check-input" id="addItemActive" name="is_active" type="checkbox" value="1" checked>
                            <label class="form-check-label" for="addItemActive">ูุดุท ูู ุงููุงุฌูุฉ ุงูุนุงูุฉ</label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                        <button type="submit" class="btn btn-primary" id="addListSubmit">ุญูุธ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ุชุนุฏูู ุนูุตุฑ -->
    <div
        class="modal fade"
        id="editListModal"
        tabindex="-1"
        aria-labelledby="editListModalLabel"
        aria-hidden="true"
        data-update-city-action="{{ url_for('admin.update_city', item_id='__ID__') }}"
        data-update-industry-action="{{ url_for('admin.update_industry', item_id='__ID__') }}"
    >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editListModalLabel">ุชุนุฏูู ุนูุตุฑ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="post" id="editListForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label" for="editItemName">ุงูุงุณู</label>
                            <input class="form-control" id="editItemName" name="name" type="text" required>
                        </div>
                        <div class="form-check form-switch">
                            <input type="hidden" name="is_active" value="0">
                            <input class="form-check-input" id="editItemActive" name="is_active" type="checkbox" value="1">
                            <label class="form-check-label" for="editItemActive">ูุดุท ูู ุงููุงุฌูุฉ ุงูุนุงูุฉ</label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
                        <button type="submit" class="btn btn-primary" id="editListSubmit">ุญูุธ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='admin/js/admin_settings_modals.js') }}" defer></script>
{% endblock %}
