<!-- LINKED: Standardized conditional access checks across templates using current_user-based logic. -->
<!-- LINKED: Added logout flow for member portal (no design change) -->
<!-- Implements proper session termination and user redirect while preserving full mobile-first UI. -->
<!-- LINKED: Shared Offers & Redemptions Integration (no schema changes) -->
<!-- FIXED: Mobile-First User Portal Design (Member-Only) -->
{% extends 'members/portal/base.html' %}
{% block title %}الملف الشخصي · ELITE{% endblock %}
{% block page_heading %}ملفي{% endblock %}
{% block content %}
<section>
    <article class="profile-card" id="membership-card" data-member-name="{{ membership_card.name }}"
        data-member-code="{{ membership_card.code }}" data-member-joined="{{ membership_card.joined }}">
        <header class="profile-card__header">
            <div>
                <h1 class="profile-card__title">{{ membership_card.name }}</h1>
                <p class="profile-card__label">عضوية رقم {{ membership_card.code }}</p>
            </div>
        </header>
        <div class="profile-card__details">
            <div>
                <p class="profile-card__label">تاريخ الانضمام</p>
                <p class="profile-card__value">{{ membership_card.joined }}</p>
            </div>
            <div>
                <p class="profile-card__label">الحالة</p>
                <p class="profile-card__value">{{ 'مفعل' if current_user.is_authenticated and current_user.is_active
                    else 'غير مفعل' }}</p>
            </div>
        </div>
    </article>
    <div class="profile-actions">
        <button class="ghost-button" type="button" id="download-card">Download My Card</button>
        <a class="ghost-button logout-button" id="logout-action" href="{{ url_for('auth.logout') }}" role="button"
            rel="nofollow">تسجيل الخروج</a>
    </div>

    <section class="activations-panel">
        <header class="panel-header">
            <h2 class="panel-header__title">سجل النشاط</h2>
            <p class="panel-header__subtitle">آخر محاولات تفعيل العروض الخاصة بك.</p>
        </header>
        <div class="activity-list">
            {% if activity_entries %}
                {% for entry in activity_entries %}
                    <article class="activation-card activity-card">
                        <div class="activity-card__meta">
                            <span class="activity-card__date">{{ entry.created_at }}</span>
                            <span class="activity-card__status activity-card__status--{{ entry.status }}">
                                {{ entry.label }}
                            </span>
                        </div>
                        <h3 class="activation-card__title">
                            {{ entry.offer_title }}
                        </h3>
                        <div class="activity-card__details">
                            <p class="activity-card__partner">{{ entry.partner_name }}</p>
                            <p class="activity-card__code">كود: {{ entry.code_used }}</p>
                        </div>
                    </article>
                {% endfor %}
            {% else %}
                <article class="activation-card activity-card activity-card--empty">
                    <h3 class="activation-card__title">لا يوجد نشاط بعد</h3>
                    <p class="activity-card__empty">عند تفعيل أي عرض سيظهر هنا.</p>
                </article>
            {% endif %}
        </div>
    </section>
</section>

{% endblock %}
