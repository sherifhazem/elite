<!-- LINKED: Standardized conditional access checks across templates using current_user-based logic. -->
<!-- FIXED: Mobile-First User Portal Design (Member-Only) -->
{% extends 'members/portal/base.html' %}
{% block title %}الإشعارات · ELITE{% endblock %}
{% block page_heading %}الإشعارات{% endblock %}
{% block content %}
    <section class="notifications-head" id="notification-center" data-unread-count="{{ unread_count }}">
        <div>
            <h1 class="notifications-head__title">إشعاراتك اليومية</h1>
            <p class="notifications-head__subtitle">كل جديد عن العروض والعضوية سيصلك هنا مباشرة.</p>
        </div>
        <button
            class="notifications-head__action"
            type="button"
            id="mark-all-read"
            onclick="markAllNotificationsRead()"
            {% if unread_count == 0 %}disabled{% endif %}
        >
            تعليم الكل كمقروء
        </button>
    </section>
    <section>
        {% if not current_user.is_authenticated %}
            <div class="empty-state">
                <p>قم بتسجيل الدخول لعرض الإشعارات الخاصة بك.</p>
            </div>
        {% elif notifications %}
            <div class="notifications-list" role="list">
                {% for notification in notifications %}
                    <article
                        class="notification-item {% if not notification.is_read %}notification-item--unread{% endif %}"
                        data-notification-id="{{ notification.id }}"
                        data-is-read="{{ 'true' if notification.is_read else 'false' }}"
                        role="listitem"
                    >
                        <div class="notification-item__bubble">
                            <h2 class="notification-item__title">{{ notification.title }}</h2>
                            <p class="notification-item__message">{{ notification.message }}</p>
                            {% if notification.link_url %}
                                <a class="notification-thread__link" href="{{ notification.link_url }}">فتح التفاصيل</a>
                            {% endif %}
                            <div class="notification-item__meta">
                                <span>{{ notification.created_at.strftime('%Y-%m-%d %H:%M') if notification.created_at else '—' }}</span>
                                <span data-role="notification-status">{{ 'مقروء' if notification.is_read else 'غير مقروء' }}</span>
                            </div>
                            <div class="notification-item__actions">
                                <button
                                    type="button"
                                    data-action="mark-read"
                                    onclick="markNotificationRead({{ notification.id }})"
                                    {% if notification.is_read %}disabled{% endif %}
                                >
                                    تأكيد القراءة
                                </button>
                                <a href="{{ notification.link_url if notification.link_url else url_for('portal.member_portal_home') }}">فتح</a>
                            </div>
                        </div>
                    </article>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <p>لا توجد إشعارات جديدة حالياً.</p>
            </div>
        {% endif %}
    </section>
{% endblock %}
